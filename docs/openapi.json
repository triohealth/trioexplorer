{"openapi":"3.1.0","info":{"title":"Search Service","version":"0.1.0"},"paths":{"/health":{"get":{"summary":"Health","operationId":"health_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Health Health Get"}}}}}}},"/metrics":{"get":{"summary":"Metrics","description":"Expose Prometheus metrics for scraping.","operationId":"metrics_metrics_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/search":{"get":{"summary":"Search","description":"Search over indexed patient notes with configurable search mode.\n\nSupports three search modes via the 'search-type' parameter:\n- hybrid (default): Combines semantic and keyword search using reciprocal rank fusion\n- semantic: Vector similarity search only\n- keyword: BM25 full-text search only\n\nResults can be deduplicated using the 'distinct' parameter:\n- encounter (default): One result per unique encounter\n- patient: One result per unique patient\n- note: One result per unique note\n- none: Return all matching chunks without deduplication\n\nFor hybrid searches, results are combined using reciprocal rank fusion and optionally reranked with Cohere.\nFor non-hybrid searches, fusion and reranking are skipped for better performance.\n\nFilters use Search index's native array-based format. See the filters parameter description for syntax.\n\nAuthorization:\n- Global search (no cohort-ids): Auto-filtered to user's entitled cohorts, or full access with `read:global`\n- Cohort search (cohort-ids provided): Requires `read:<cohort-id>` for each requested cohort, or `read:global`","operationId":"search_search_get","parameters":[{"name":"query","in":"query","required":true,"schema":{"type":"string","description":"Text search query","title":"Query"},"description":"Text search query"},{"name":"search-type","in":"query","required":false,"schema":{"$ref":"#/components/schemas/SearchType","description":"Search mode: 'keyword' (BM25 only), 'semantic' (vector only), or 'hybrid' (both, default)","default":"hybrid"},"description":"Search mode: 'keyword' (BM25 only), 'semantic' (vector only), or 'hybrid' (both, default)"},{"name":"filters","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"JSON-encoded filter in Search index format. Example: [\"And\",[[\"note_date\",\"Gte\",\"2025-01-01\"],[\"note_type\",\"In\",[\"Progress Note\"]]]] Supported fields: note_date, note_type, patient_id, encounter_id, cohort_ids, note_quality_score, chunk_quality_score. Supported operators: And, Or, Not, Eq, NotEq, Lt, Lte, Gt, Gte, In, NotIn, Contains, ContainsAny.","title":"Filters"},"description":"JSON-encoded filter in Search index format. Example: [\"And\",[[\"note_date\",\"Gte\",\"2025-01-01\"],[\"note_type\",\"In\",[\"Progress Note\"]]]] Supported fields: note_date, note_type, patient_id, encounter_id, cohort_ids, note_quality_score, chunk_quality_score. Supported operators: And, Or, Not, Eq, NotEq, Lt, Lte, Gt, Gte, In, NotIn, Contains, ContainsAny."},{"name":"k","in":"query","required":false,"schema":{"type":"integer","maximum":300,"minimum":1,"description":"Number of unique results to return (based on distinct mode)","default":10,"title":"K"},"description":"Number of unique results to return (based on distinct mode)"},{"name":"distinct","in":"query","required":false,"schema":{"$ref":"#/components/schemas/DistinctMode","description":"De-duplication strategy for results. 'encounter' (default): one result per encounter, 'patient': one result per patient, 'note': one result per note, 'none': return all chunks without deduplication. The 'k' parameter specifies how many unique {distinct_field} values to return.","default":"encounter"},"description":"De-duplication strategy for results. 'encounter' (default): one result per encounter, 'patient': one result per patient, 'note': one result per note, 'none': return all chunks without deduplication. The 'k' parameter specifies how many unique {distinct_field} values to return."},{"name":"cohort-ids","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Comma-separated list of cohort IDs for scoping search (e.g., '123,456,789'). Single cohort uses dedicated cohort index; multiple cohorts use global index with filtering.","title":"Cohort-Ids"},"description":"Comma-separated list of cohort IDs for scoping search (e.g., '123,456,789'). Single cohort uses dedicated cohort index; multiple cohorts use global index with filtering."},{"name":"rerank","in":"query","required":false,"schema":{"type":"boolean","description":"Apply Cohere reranking to results","default":true,"title":"Rerank"},"description":"Apply Cohere reranking to results"},{"name":"vector_weight","in":"query","required":false,"schema":{"type":"number","maximum":1.0,"minimum":0.0,"description":"Weight for vector search in fusion (0-1)","default":0.7,"title":"Vector Weight"},"description":"Weight for vector search in fusion (0-1)"},{"name":"top_k_retrieval","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","maximum":10000,"minimum":1},{"type":"null"}],"description":"Number of results to retrieve before reranking (defaults to 4*k, max 10000)","title":"Top K Retrieval"},"description":"Number of results to retrieve before reranking (defaults to 4*k, max 10000)"},{"name":"distance_threshold","in":"query","required":false,"schema":{"type":"number","maximum":2.0,"minimum":0.0,"description":"Maximum distance for semantic matches (0-2, lower is more similar)","default":0.7,"title":"Distance Threshold"},"description":"Maximum distance for semantic matches (0-2, lower is more similar)"},{"name":"chunk-multiplier","in":"query","required":false,"schema":{"type":"number","maximum":5.0,"minimum":1.0,"description":"Multiplier for initial chunk retrieval to ensure k unique notes after deduplication","default":2.0,"title":"Chunk-Multiplier"},"description":"Multiplier for initial chunk retrieval to ensure k unique notes after deduplication"},{"name":"min-quality-score","in":"query","required":false,"schema":{"anyOf":[{"type":"number","maximum":1.0,"minimum":0.0},{"type":"null"}],"description":"Minimum note-level quality score (0.0-1.0). Notes with note_quality_score below this threshold are excluded.","title":"Min-Quality-Score"},"description":"Minimum note-level quality score (0.0-1.0). Notes with note_quality_score below this threshold are excluded."},{"name":"min-chunk-quality-score","in":"query","required":false,"schema":{"anyOf":[{"type":"number","maximum":1.0,"minimum":0.0},{"type":"null"}],"description":"Minimum chunk-level quality score (0.0-1.0). Chunks with chunk_quality_score below this threshold are excluded.","title":"Min-Chunk-Quality-Score"},"description":"Minimum chunk-level quality score (0.0-1.0). Chunks with chunk_quality_score below this threshold are excluded."},{"name":"entity-filters","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"JSON-encoded entity/assertion filters. Example: {\"diagnoses_present\": [\"asthma\"], \"symptoms_negated\": [\"fever\"]} Supported fields: 13 entity types (symptoms, diagnoses, medications, procedures, lab_tests, allergies, vitals, anatomy, devices, organisms, substances, observations, social), 5 assertion types (present, negated, historical, hypothetical, family), and 65 entity-assertion combinations ({entity}_{assertion}). Values are matched using Search index's ContainsAny operator.","title":"Entity-Filters"},"description":"JSON-encoded entity/assertion filters. Example: {\"diagnoses_present\": [\"asthma\"], \"symptoms_negated\": [\"fever\"]} Supported fields: 13 entity types (symptoms, diagnoses, medications, procedures, lab_tests, allergies, vitals, anatomy, devices, organisms, substances, observations, social), 5 assertion types (present, negated, historical, hypothetical, family), and 65 entity-assertion combinations ({entity}_{assertion}). Values are matched using Search index's ContainsAny operator."},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response Search Search Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/search-events":{"get":{"summary":"Get Search Events","description":"Get search history events for the authenticated API key.\n\nRequires read-level access. If api-key-id is provided, it must match the authenticated key\n(unless the key has admin entitlement). If not provided, returns events for the authenticated key.","operationId":"get_search_events_search_events_get","parameters":[{"name":"api-key-id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by API key ID (must match authenticated key unless admin)","title":"Api-Key-Id"},"description":"Filter by API key ID (must match authenticated key unless admin)"},{"name":"search_type","in":"query","required":false,"schema":{"anyOf":[{"$ref":"#/components/schemas/SearchType"},{"type":"null"}],"description":"Filter by search type","title":"Search Type"},"description":"Filter by search type"},{"name":"date_from","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"description":"Filter from date","title":"Date From"},"description":"Filter from date"},{"name":"date_to","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"description":"Filter to date","title":"Date To"},"description":"Filter to date"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Limit number of results","default":10,"title":"Limit"},"description":"Limit number of results"},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/SearchEvent"},"title":"Response Get Search Events Search Events Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/judgement-lists":{"post":{"summary":"Create Judgement List","description":"Create a judgement list. Requires admin authentication.\nNote: This is a placeholder implementation. The judgement_list table needs to be created in Postgres.","operationId":"create_judgement_list_judgement_lists_post","parameters":[{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateJudgementListRequest"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JudgementList"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"get":{"summary":"List Judgement Lists","description":"List judgement lists. Requires admin authentication.\nNote: This is a placeholder implementation.","operationId":"list_judgement_lists_judgement_lists_get","parameters":[{"name":"patient_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by patient ID","title":"Patient Id"},"description":"Filter by patient ID"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Limit number of results","default":10,"title":"Limit"},"description":"Limit number of results"},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JudgementListListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/judgement-lists/{judgement_list_id}":{"get":{"summary":"Get Judgement List","description":"Get a judgement list by ID. Requires admin authentication.\nNote: This is a placeholder implementation.","operationId":"get_judgement_list_judgement_lists__judgement_list_id__get","parameters":[{"name":"judgement_list_id","in":"path","required":true,"schema":{"type":"string","title":"Judgement List Id"}},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JudgementList"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"put":{"summary":"Update Judgement List","description":"Update a judgement list. Requires admin authentication.\nNote: This is a placeholder implementation.","operationId":"update_judgement_list_judgement_lists__judgement_list_id__put","parameters":[{"name":"judgement_list_id","in":"path","required":true,"schema":{"type":"string","title":"Judgement List Id"}},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateJudgementListRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JudgementList"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"summary":"Delete Judgement List","description":"Delete a judgement list. Requires admin authentication.\nNote: This is a placeholder implementation.","operationId":"delete_judgement_list_judgement_lists__judgement_list_id__delete","parameters":[{"name":"judgement_list_id","in":"path","required":true,"schema":{"type":"string","title":"Judgement List Id"}},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/note-types":{"get":{"summary":"Get Note Types","description":"Get available note types globally, optionally filtered by search term.\n\nReturns all note types discovered across the system.\n\nRequires read-level access (any read entitlement).","operationId":"get_note_types_note_types_get","parameters":[{"name":"search","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Search note types by name (case-insensitive partial match)","title":"Search"},"description":"Search note types by name (case-insensitive partial match)"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":1000,"minimum":1,"description":"Maximum number of note types to return","default":100,"title":"Limit"},"description":"Maximum number of note types to return"},{"name":"offset","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Number of note types to skip (for pagination)","default":0,"title":"Offset"},"description":"Number of note types to skip (for pagination)"},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NoteTypesResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/search-history":{"get":{"summary":"List Search History","description":"Get paginated search history for the authenticated API key.\n\nReturns a list of search history entries with rich filtering options.\nResults are ordered by most recent first.\n\nRequires read-level access (any read entitlement).","operationId":"list_search_history_search_history_get","parameters":[{"name":"user-id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by user ID","title":"User-Id"},"description":"Filter by user ID"},{"name":"search-type","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by search type (hybrid, semantic, keyword)","title":"Search-Type"},"description":"Filter by search type (hybrid, semantic, keyword)"},{"name":"query","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by query text (case-insensitive substring match)","title":"Query"},"description":"Filter by query text (case-insensitive substring match)"},{"name":"date-from","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"description":"Filter from date (ISO format)","title":"Date-From"},"description":"Filter from date (ISO format)"},{"name":"date-to","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"description":"Filter to date (ISO format)","title":"Date-To"},"description":"Filter to date (ISO format)"},{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"description":"Page number (1-indexed)","default":1,"title":"Page"},"description":"Page number (1-indexed)"},{"name":"page_size","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Number of items per page","default":20,"title":"Page Size"},"description":"Number of items per page"},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SearchHistoryListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/search-history/{history_id}":{"get":{"summary":"Get Search History Details","description":"Get a specific search history entry by ID.\n\nReturns the full details including request and response payloads.\n\nRequires read-level access (any read entitlement).\nOnly returns entries for the authenticated API key.","operationId":"get_search_history_details_search_history__history_id__get","parameters":[{"name":"history_id","in":"path","required":true,"schema":{"type":"string","title":"History Id"}},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SearchHistoryEntry"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/search-history/stats/summary":{"get":{"summary":"Get Search Stats","description":"Get aggregated statistics for search history.\n\nReturns metrics like total searches, unique queries, average results,\nand breakdown by search type.\n\nRequires read-level access (any read entitlement).","operationId":"get_search_stats_search_history_stats_summary_get","parameters":[{"name":"date-from","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"description":"Filter from date (ISO format)","title":"Date-From"},"description":"Filter from date (ISO format)"},{"name":"date-to","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"description":"Filter to date (ISO format)","title":"Date-To"},"description":"Filter to date (ISO format)"},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SearchHistoryStats"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cohorts/indexed":{"get":{"summary":"List Indexed Cohorts","description":"List cohorts that are indexed and available for search.\n\nA cohort is considered \"indexed\" when:\n1. Search index namespace exists with pattern: cohort-{id}-{namespace_slug}\n2. Namespace contains vectors (approx_row_count > 0)\n\nThis endpoint lists cohorts based on actual Search index data, not job status.\nA cohort appears here if it has searchable vectors, regardless of job state.\n\nReturns cohorts ordered by cohort_id (ascending).\n\nRequires read-level access (any read entitlement).","operationId":"list_indexed_cohorts_cohorts_indexed_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Maximum number of cohorts to return","default":10,"title":"Limit"},"description":"Maximum number of cohorts to return"},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/IndexedCohortsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/noise-categories":{"get":{"summary":"List Noise Categories Endpoint","description":"List all noise categories (read-only).\n\nThis endpoint is read-only and does not require admin privileges.\nRequires any read entitlement (read:global or read:<cohort-id>).\n\nArgs:\n    include_inactive: Include inactive categories in the response\n    db: Database session\n    _current_key: Authenticated API key\n\nReturns:\n    List of noise categories","operationId":"list_noise_categories_endpoint_noise_categories_get","parameters":[{"name":"include_inactive","in":"query","required":false,"schema":{"type":"boolean","description":"Include inactive categories","default":false,"title":"Include Inactive"},"description":"Include inactive categories"},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/NoiseCategoryResponse"},"title":"Response List Noise Categories Endpoint Noise Categories Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/noise-rules":{"get":{"summary":"List Noise Rules Endpoint","description":"List noise rules (read-only).\n\nThis endpoint is read-only and does not require admin privileges.\nRequires any read entitlement (read:global or read:<cohort-id>).\n\nArgs:\n    category_id: Optional category ID to filter by\n    include_inactive: Include inactive rules in the response\n    db: Database session\n    _current_key: Authenticated API key\n\nReturns:\n    List of noise rules","operationId":"list_noise_rules_endpoint_noise_rules_get","parameters":[{"name":"category_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by category ID","title":"Category Id"},"description":"Filter by category ID"},{"name":"include_inactive","in":"query","required":false,"schema":{"type":"boolean","description":"Include inactive rules","default":false,"title":"Include Inactive"},"description":"Include inactive rules"},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/NoiseRuleResponse"},"title":"Response List Noise Rules Endpoint Noise Rules Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/namespaces/{namespace}/filter-values":{"get":{"summary":"Get Filter Values","description":"Get all filter values for a namespace, grouped by field name.\n\nReturns discovered entity, assertion, and entity-assertion matrix values\nthat have been indexed to Search index for this namespace. These values\nenable UI discoverability for building search filters.\n\nRequires read-level access (any read entitlement).","operationId":"get_filter_values_namespaces__namespace__filter_values_get","parameters":[{"name":"namespace","in":"path","required":true,"schema":{"type":"string","title":"Namespace"}},{"name":"field_category","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by field category: 'entity', 'assertion', or 'entity_assertion'","title":"Field Category"},"description":"Filter by field category: 'entity', 'assertion', or 'entity_assertion'"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":1000,"minimum":1,"description":"Maximum number of values per field","default":100,"title":"Limit"},"description":"Maximum number of values per field"},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterValuesResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/namespaces/{namespace}/filter-fields":{"get":{"summary":"Get Filter Fields","description":"Get metadata about available filter fields for a namespace.\n\nReturns a list of field names with their categories and value counts,\nwithout returning the actual values. Useful for UI to display available\nfilter options before fetching the full value list.\n\nRequires read-level access (any read entitlement).","operationId":"get_filter_fields_namespaces__namespace__filter_fields_get","parameters":[{"name":"namespace","in":"path","required":true,"schema":{"type":"string","title":"Namespace"}},{"name":"field_category","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by field category: 'entity', 'assertion', or 'entity_assertion'","title":"Field Category"},"description":"Filter by field category: 'entity', 'assertion', or 'entity_assertion'"},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterFieldsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/namespaces/{namespace}/filter-values/{field_name}":{"get":{"summary":"Get Field Filter Values","description":"Get filter values for a specific field within a namespace.\n\nReturns the list of discovered values for a single field (e.g., \"symptoms\",\n\"present\", \"symptoms_present\") with pagination and search support.\n\nRequires read-level access (any read entitlement).","operationId":"get_field_filter_values_namespaces__namespace__filter_values__field_name__get","parameters":[{"name":"namespace","in":"path","required":true,"schema":{"type":"string","title":"Namespace"}},{"name":"field_name","in":"path","required":true,"schema":{"type":"string","title":"Field Name"}},{"name":"search","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Search filter values by text (case-insensitive partial match)","title":"Search"},"description":"Search filter values by text (case-insensitive partial match)"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":1000,"minimum":1,"description":"Maximum number of values to return","default":100,"title":"Limit"},"description":"Maximum number of values to return"},{"name":"offset","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Number of values to skip (for pagination)","default":0,"title":"Offset"},"description":"Number of values to skip (for pagination)"},{"name":"X-API-Key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FieldFilterValuesResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"CreateJudgementListRequest":{"properties":{"search_term":{"type":"string","minLength":1,"title":"Search Term","description":"Search term"},"patient_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Patient Id","description":"Patient ID"},"results":{"items":{"$ref":"#/components/schemas/JudgementListResult"},"type":"array","minItems":10,"title":"Results","description":"Judgement results"}},"type":"object","required":["search_term","results"],"title":"CreateJudgementListRequest"},"DistinctMode":{"type":"string","enum":["encounter","patient","note","none"],"title":"DistinctMode","description":"De-duplication strategy for search results.\n\n- encounter: One result per unique encounter_id (default)\n- patient: One result per unique patient_id\n- note: One result per unique note_id\n- none: Return all chunks without deduplication"},"FieldFilterValuesResponse":{"properties":{"namespace":{"type":"string","title":"Namespace","description":"Search index namespace"},"field_name":{"type":"string","title":"Field Name","description":"Field name"},"field_category":{"type":"string","title":"Field Category","description":"Category: 'entity', 'assertion', or 'entity_assertion'"},"values":{"items":{"$ref":"#/components/schemas/FilterValueItem"},"type":"array","title":"Values","description":"List of filter values"},"total_values":{"type":"integer","minimum":0.0,"title":"Total Values","description":"Total number of values for this field"}},"type":"object","required":["namespace","field_name","field_category","values","total_values"],"title":"FieldFilterValuesResponse","description":"Response for listing filter values for a single field."},"FilterFieldMeta":{"properties":{"field_name":{"type":"string","title":"Field Name","description":"Field name (e.g., 'symptoms', 'present', 'symptoms_present')"},"field_category":{"type":"string","title":"Field Category","description":"Category: 'entity', 'assertion', or 'entity_assertion'"},"value_count":{"type":"integer","minimum":0.0,"title":"Value Count","description":"Number of distinct values for this field"}},"type":"object","required":["field_name","field_category","value_count"],"title":"FilterFieldMeta","description":"Metadata about a filter field."},"FilterFieldsResponse":{"properties":{"namespace":{"type":"string","title":"Namespace","description":"Search index namespace"},"fields":{"items":{"$ref":"#/components/schemas/FilterFieldMeta"},"type":"array","title":"Fields","description":"List of filter fields with metadata"},"total_fields":{"type":"integer","minimum":0.0,"title":"Total Fields","description":"Total number of filter fields"}},"type":"object","required":["namespace","fields","total_fields"],"title":"FilterFieldsResponse","description":"Response for listing filter field metadata."},"FilterValueItem":{"properties":{"id":{"type":"string","title":"Id","description":"Filter value ID (UUID)"},"text_value":{"type":"string","title":"Text Value","description":"Display text for the filter value"},"cui":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Cui","description":"UMLS CUI if available"},"occurrence_count":{"type":"integer","minimum":0.0,"title":"Occurrence Count","description":"Number of documents containing this value"},"first_seen_at":{"type":"string","format":"date-time","title":"First Seen At","description":"When this value was first indexed"},"last_seen_at":{"type":"string","format":"date-time","title":"Last Seen At","description":"When this value was last indexed"}},"type":"object","required":["id","text_value","occurrence_count","first_seen_at","last_seen_at"],"title":"FilterValueItem","description":"Single filter value for a field within a namespace."},"FilterValuesResponse":{"properties":{"namespace":{"type":"string","title":"Namespace","description":"Search index namespace"},"fields":{"additionalProperties":{"items":{"$ref":"#/components/schemas/FilterValueItem"},"type":"array"},"type":"object","title":"Fields","description":"Filter values grouped by field name"},"total_fields":{"type":"integer","minimum":0.0,"title":"Total Fields","description":"Total number of filter fields"},"total_values":{"type":"integer","minimum":0.0,"title":"Total Values","description":"Total number of filter values across all fields"}},"type":"object","required":["namespace","fields","total_fields","total_values"],"title":"FilterValuesResponse","description":"Response for listing all filter values in a namespace."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"IndexedCohortInfo":{"properties":{"cohort_id":{"type":"string","title":"Cohort Id","description":"Cohort ID"},"cohort_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Cohort Name","description":"Cohort name from admin.cached_cohorts (null if not found)"},"namespace":{"type":"string","title":"Namespace","description":"Search index namespace name"},"chunk_count":{"type":"integer","title":"Chunk Count","description":"Number of indexed chunks (vectors)"},"index_status":{"type":"string","title":"Index Status","description":"Search index index status"}},"type":"object","required":["cohort_id","namespace","chunk_count","index_status"],"title":"IndexedCohortInfo","description":"Information about an indexed cohort available for search."},"IndexedCohortsResponse":{"properties":{"items":{"items":{"$ref":"#/components/schemas/IndexedCohortInfo"},"type":"array","title":"Items","description":"List of fully indexed cohorts"},"total_count":{"type":"integer","title":"Total Count","description":"Total number of indexed cohorts found"}},"type":"object","required":["items","total_count"],"title":"IndexedCohortsResponse","description":"Response for list of indexed cohorts."},"JudgementList":{"properties":{"judgement_list_id":{"type":"string","title":"Judgement List Id","description":"Judgement list ID"},"search_term":{"type":"string","title":"Search Term","description":"Search term"},"search_term_hash":{"type":"string","title":"Search Term Hash","description":"Search term hash"},"patient_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Patient Id","description":"Patient ID"},"result_count":{"type":"integer","title":"Result Count","description":"Result count"},"created_at":{"type":"string","format":"date-time","title":"Created At","description":"Creation timestamp"},"results":{"items":{"$ref":"#/components/schemas/JudgementListResult"},"type":"array","title":"Results","description":"Judgement results"},"updated_at":{"type":"string","format":"date-time","title":"Updated At","description":"Update timestamp"}},"type":"object","required":["judgement_list_id","search_term","search_term_hash","result_count","created_at","results","updated_at"],"title":"JudgementList"},"JudgementListListResponse":{"properties":{"items":{"items":{"$ref":"#/components/schemas/JudgementListSummary"},"type":"array","title":"Items","description":"Judgement list items"}},"type":"object","required":["items"],"title":"JudgementListListResponse"},"JudgementListResult":{"properties":{"note_id":{"type":"string","title":"Note Id","description":"Note ID"},"index_slug":{"type":"string","title":"Index Slug","description":"Index slug"},"rank":{"type":"integer","minimum":1.0,"title":"Rank","description":"Result rank"}},"type":"object","required":["note_id","index_slug","rank"],"title":"JudgementListResult"},"JudgementListSummary":{"properties":{"judgement_list_id":{"type":"string","title":"Judgement List Id","description":"Judgement list ID"},"search_term":{"type":"string","title":"Search Term","description":"Search term"},"search_term_hash":{"type":"string","title":"Search Term Hash","description":"Search term hash"},"patient_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Patient Id","description":"Patient ID"},"result_count":{"type":"integer","title":"Result Count","description":"Result count"},"created_at":{"type":"string","format":"date-time","title":"Created At","description":"Creation timestamp"}},"type":"object","required":["judgement_list_id","search_term","search_term_hash","result_count","created_at"],"title":"JudgementListSummary"},"NoiseCategoryResponse":{"properties":{"category_id":{"type":"string","title":"Category Id","description":"Category ID (UUID)"},"category_name":{"type":"string","title":"Category Name","description":"Category name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description","description":"Category description"},"is_active":{"type":"boolean","title":"Is Active","description":"Whether category is active"}},"type":"object","required":["category_id","category_name","is_active"],"title":"NoiseCategoryResponse","description":"Read-only noise category response."},"NoiseRuleResponse":{"properties":{"rule_id":{"type":"string","title":"Rule Id","description":"Rule ID (UUID)"},"category_id":{"type":"string","title":"Category Id","description":"Category ID (UUID)"},"rule_name":{"type":"string","title":"Rule Name","description":"Rule name"},"rule_type":{"type":"string","title":"Rule Type","description":"Rule type (regex, keyword_list, substring)"},"pattern":{"type":"string","title":"Pattern","description":"Pattern to match"},"case_sensitive":{"type":"boolean","title":"Case Sensitive","description":"Whether matching is case sensitive"},"is_active":{"type":"boolean","title":"Is Active","description":"Whether rule is active"},"priority":{"type":"integer","title":"Priority","description":"Rule priority (0-1000, lower = higher priority)"}},"type":"object","required":["rule_id","category_id","rule_name","rule_type","pattern","case_sensitive","is_active","priority"],"title":"NoiseRuleResponse","description":"Read-only noise rule response."},"NoteTypeItem":{"properties":{"id":{"type":"string","title":"Id","description":"Note type ID"},"note_type":{"type":"string","title":"Note Type","description":"Note type name"},"first_seen_at":{"type":"string","format":"date-time","title":"First Seen At","description":"First seen timestamp"},"last_seen_at":{"type":"string","format":"date-time","title":"Last Seen At","description":"Last seen timestamp"},"note_count":{"type":"integer","minimum":0.0,"title":"Note Count","description":"Number of notes of this type"}},"type":"object","required":["id","note_type","first_seen_at","last_seen_at","note_count"],"title":"NoteTypeItem"},"NoteTypesResponse":{"properties":{"items":{"items":{"$ref":"#/components/schemas/NoteTypeItem"},"type":"array","title":"Items","description":"List of note types"},"total_count":{"type":"integer","title":"Total Count","description":"Total count of note types matching filters"}},"type":"object","required":["items","total_count"],"title":"NoteTypesResponse"},"SearchEvent":{"properties":{"search_id":{"type":"string","title":"Search Id","description":"Search event ID"},"api_key_id":{"type":"string","title":"Api Key Id","description":"API key ID"},"search_type":{"$ref":"#/components/schemas/SearchType","description":"Search type"},"term":{"type":"string","title":"Term","description":"Search term"},"executed_at":{"type":"string","format":"date-time","title":"Executed At","description":"Execution timestamp"},"result_count":{"type":"integer","title":"Result Count","description":"Number of results"},"clicked_order":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Clicked Order","description":"Clicked result order"},"flags":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Flags","description":"Additional flags"}},"type":"object","required":["search_id","api_key_id","search_type","term","executed_at","result_count"],"title":"SearchEvent"},"SearchHistoryEntry":{"properties":{"id":{"type":"string","title":"Id","description":"Search history ID"},"api_key_id":{"type":"string","title":"Api Key Id","description":"API key ID"},"user_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Id","description":"User ID"},"search_type":{"type":"string","title":"Search Type","description":"Search type"},"query":{"type":"string","title":"Query","description":"Search query"},"request_payload":{"additionalProperties":true,"type":"object","title":"Request Payload","description":"Request parameters"},"response_payload":{"additionalProperties":true,"type":"object","title":"Response Payload","description":"Response data"},"result_count":{"type":"integer","title":"Result Count","description":"Result count"},"duration_ms":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Duration Ms","description":"Duration in milliseconds"},"status_code":{"type":"integer","title":"Status Code","description":"Status code"},"error_message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error Message","description":"Error message"},"created_at":{"type":"string","format":"date-time","title":"Created At","description":"Timestamp"}},"type":"object","required":["id","api_key_id","search_type","query","request_payload","response_payload","result_count","status_code","created_at"],"title":"SearchHistoryEntry","description":"Model for a search history entry."},"SearchHistoryListResponse":{"properties":{"items":{"items":{"$ref":"#/components/schemas/SearchHistoryEntry"},"type":"array","title":"Items","description":"List of search history entries"},"total_count":{"type":"integer","title":"Total Count","description":"Total count matching filters"},"page":{"type":"integer","title":"Page","description":"Current page number"},"page_size":{"type":"integer","title":"Page Size","description":"Number of items per page"},"has_more":{"type":"boolean","title":"Has More","description":"Whether there are more results"}},"type":"object","required":["items","total_count","page","page_size","has_more"],"title":"SearchHistoryListResponse","description":"Model for paginated search history list."},"SearchHistoryStats":{"properties":{"total_searches":{"type":"integer","title":"Total Searches","description":"Total number of searches"},"unique_queries":{"type":"integer","title":"Unique Queries","description":"Number of unique queries"},"avg_result_count":{"type":"number","title":"Avg Result Count","description":"Average number of results per search"},"avg_duration_ms":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Avg Duration Ms","description":"Average duration in milliseconds"},"searches_by_type":{"additionalProperties":{"type":"integer"},"type":"object","title":"Searches By Type","description":"Count of searches by type"},"date_range":{"additionalProperties":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}]},"type":"object","title":"Date Range","description":"Date range of results"}},"type":"object","required":["total_searches","unique_queries","avg_result_count","searches_by_type","date_range"],"title":"SearchHistoryStats","description":"Model for search history statistics."},"SearchType":{"type":"string","enum":["hybrid","semantic","keyword"],"title":"SearchType"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}